% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stratified_weighted_logrank.R
\name{stratified_weighted_logrank}
\alias{stratified_weighted_logrank}
\title{Stratified Weighted Log-Rank test (FH + optional IPW)}
\usage{
stratified_weighted_logrank(
  data,
  time,
  status,
  group,
  strata,
  rho = 0,
  gamma = 0,
  ipw = NULL
)
}
\arguments{
\item{data}{data.frame with time, status, group, strata.}

\item{time, status, group, strata}{Character names of columns.}

\item{rho, gamma}{FH exponents; default 0,0.}

\item{ipw}{Optional subject-level weights (column name).}
}
\value{
list(statistic, p.value, method, rho, gamma, n, n_strata)
}
\description{
Mantelâ€“Haenszel aggregation of weighted log-rank scores across strata.
}
\examples{
\dontshow{if (requireNamespace("survival", quietly = TRUE)) withAutoprint(\{ # examplesIf}
# Example with the 'lung' dataset from survival
lung <- survival::lung
# Convert to 1=event (death), 0=censor
lung$status01 <- as.integer(lung$status == 2)

# Use ECOG performance as a stratification factor (drop rows with NA)
df <- lung[complete.cases(lung[, c("time","status01","sex","ph.ecog")]), ]

# 1) Standard stratified log-rank (rho=0, gamma=0)
res_std <- stratified_weighted_logrank(
  data = df, time = "time", status = "status01",
  group = "sex", strata = "ph.ecog", rho = 0, gamma = 0
)
res_std$p.value

# 2) Late-emphasis weights (rho=0, gamma=1)
res_late <- stratified_weighted_logrank(
  data = df, time = "time", status = "status01",
  group = "sex", strata = "ph.ecog", rho = 0, gamma = 1
)
res_late$p.value

# 3) With subject-level IPW (demo random weights)
set.seed(123)
df$ipw <- stats::runif(nrow(df), 0.5, 1.5)
res_ipw <- stratified_weighted_logrank(
  data = df, time = "time", status = "status01",
  group = "sex", strata = "ph.ecog", rho = 0, gamma = 0, ipw = "ipw"
)
res_ipw$p.value

# 4) (Optional) Compare to survival::survdiff when rho=0
sd_fit <- survival::survdiff(
  survival::Surv(time, status01) ~ sex + strata(ph.ecog),
  data = df, rho = 0
)
p_ref <- stats::pchisq(as.numeric(sd_fit$chisq), df = 1, lower.tail = FALSE)
p_ref
\dontshow{\}) # examplesIf}
}
