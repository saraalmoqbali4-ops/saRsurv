)
# Display the survival object summary
print(fit_all)
# Plot the overall survival curve
plot(fit_all,
main = "Kaplan–Meier Curve (Overall Survival)",  # Title of the plot
xlab = "Stage (Time)",                           # Label for X-axis
ylab = "Survival Probability")                   # Label for Y-axis
# Fit Kaplan–Meier survival curves by gender
fit_gender <- survfit_weighted(
data = mydata,
time = "stag",
status = "event",
strata = "gender"
)
# Plot the survival curves for each gender
plot(fit_gender,
col = c("blue", "red"),                     # Colors for male/female groups
lty = 1:2,                                  # Line types (solid/dashed)
main = "Kaplan–Meier Survival by Gender",   # Plot title
xlab = "Stage (Time)",                      # Label for X-axis
ylab = "Survival Probability")              # Label for Y-axis
# Add a legend to distinguish gender groups
legend("topright",
legend = levels(factor(mydata$gender)),   # Gender labels
col = c("blue", "red"),                   # Matching colors
lty = 1:2)                                # Matching line types
logrank_res <- weighted_logrank(
data = mydata,
time = "stag",
status = "event",
group = "gender"
)
print(logrank_res)
strat_res <- stratified_weighted_logrank(
data = mydata,
time = "stag",
status = "event",
group = "gender",
strata = "industry"
)
# Fit Kaplan–Meier survival curves by gender
fit <- survfit_weighted(
data = mydata,
time = "stag",
status = "event",
strata = "gender"
)
# Compute the Risk-Adjusted Life Expectancy (RALE) from the fitted survival object
rale_res <- compute_rale(fit, t0 = 0)
# Display the RALE results
print(rale_res)
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
data(lung)
# Recode status: 1 = censored, 2 = death → we need 0/1 format
lung$status01 <- as.integer(lung$status == 2)
# Preview the data
head(lung)
fit_all <- survfit_weighted(
data = lung,
time = "time",
status = "status01"
)
# Plot the survival curve
plot(
fit_all,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability"
)
strat_res <- stratified_weighted_logrank(
data = lung,
time = "time",
status = "status01",
group = "sex",         # Compare male vs female
strata = "ph.ecog"     # Stratify by performance status
)
strat_res
cox_fit <- fit_cox_cluster(
data = lung,
time = "time",
status = "status01",
covars = c("age", "sex", "ph.ecog"),
engine = "coxph_robust"   # Use robust variance
)
# Show summary of the model
summary(cox_fit)
#Compute RALE
rale_res <- compute_rale(fit_all)
print(rale_res)
#Compute RALE
rale_res <- compute_rale(fit_all)
rale_res
#Compute Alpha for Stratified Groups
alpha_res <- compute_strata_alpha(
data = lung,
time = "time",
status = "status01",
strata = "sex"
)
#Compute Alpha for Stratified Groups
alpha_res <- compute_strata_alpha(
data = lung,
time = "time",
status = "status01",
strata = "sex"
)
help( compute_strata_alpha)
help(compute_strata_alpha)
# Compute Alpha for Stratified Groups
# The function computes alpha (α) weights for each group level.
# These weights represent the relative importance or scaling
alpha_res <- compute_strata_alpha(
x = lung$sex,          # Grouping variable (e.g., male vs. female)
transform = "linear",  # Transformation type: "log", "sqrt", "linear", etc.
min_alpha = 0.3,
max_alpha = 1,
return_df = TRUE
)
alpha_res
plot_cox_forest(cox_fit)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
cal <- calibrate_surv(
fit = cox_fit,
data = lung,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
help(calibrate_surv)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
cox_fit <- fit_cox_cluster(
data = lung,
time = "time",
status = "status01",
covars = c("age", "sex", "ph.ecog"),
engine = "coxph_robust",
x = TRUE,
y = TRUE
)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
print(cal)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)  # the data has the missng value
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
cal
# Plot the Calibration Curve
p_cal <- plot_calibration_surv(cal)
print(p_cal)
library(survival)
library(saRsurv)
library(dplyr)
data(veteran)
head(veteran)
fit_km <- survfit_weighted(
data = veteran,
time = "time",
status = "status"
)
plot(fit_km,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability")
fit_km_group <- survfit_weighted(
data = veteran,
time = "time",
status = "status",
strata = "trt"
)
plot(fit_km_group,
main = "Kaplan–Meier by Treatment",
col = c("blue", "red"),
lty = 1:2)
legend("topright", legend = levels(factor(veteran$trt)),
col = c("blue", "red"), lty = 1:2)
res_logrank <- weighted_logrank(
data = veteran,
time = "time",
status = "status",
group = "trt"
)
print(res_logrank)
fit_cph <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status",
covariates = c("age", "trt", "celltype")
)
fit_auto <- fit_cox_auto(
data = veteran,
time = "time",
status = "status"
)
log_grid <- logrank_grid(
data = veteran,
time = "time",
status = "status",
group = "trt"
)
print(log_grid)
plot_km_alpha(
data = veteran,
time = "time",
status = "status",
strata = "trt",
alpha = 0.05
)
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
data(veteran)
# Recode status (1=censored, 2=dead → make it 0/1)
veteran$status01 <- as.integer(veteran$status == 1) # or == 2 based on definition
head(veteran)
fit_all <- fit_km(data = veteran, time = "time", status = "status01")
plot(fit_all, main = "Overall Survival (veteran data)", xlab = "Days", ylab = "Survival Probability")
# Automatic KM by group (treatment group: trt)
fit_trt <- fit_km_auto(data = veteran, time = "time", status = "status01", strata = "trt")
plot(fit_trt, main = "Kaplan–Meier by Treatment Group", xlab = "Days", ylab = "Survival Probability")
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr, main = "FH Log-Rank Grid (Veteran)")
cox_fit <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status01",
covars = c("age", "trt", "celltype", "karno"),
engine = "coxph_robust"
)
summary(cox_fit)
# Forest Plot for Cox Model
plot_cox_forest(cox_fit)
rale_res <- compute_rale(fit_all)
print(rale_res)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt, data = veteran)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(
fit_trt,
data = veteran,
group_var = "trt"
)
veteran_clean <- na.omit(veteran)
cal <- calibrate_surv(
fit = cox_fit,
data = veteran_clean,
time_col = "time",
status_col = "status01",
time_point = 180,   # half a year for calibration
ngroups = 10,
observed_method = "km"
)
print(cal)
plot_calibration_surv(cal)
plot_rale_by_strata(fit_trt)
plot_stratified_logrank(data = veteran, time = "time", status = "status01", group = "trt", strata = "celltype")
#Compute Alpha for Stratified Group
# Fit Kaplan–Meier model with explicit formula
fit_trt <- fit_km(
data = veteran,
time = "time",
status = "status01",
strata = "trt"
)
# Compute alpha values
alpha_res <- compute_strata_alpha(
x = veteran$trt,
transform = "linear",
return_df = TRUE
)
print(alpha_res)
# Plot KM with alpha transparency
plot_km_alpha(
fit_trt,
data = veteran,
group_var = "trt"
)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
cox_fit <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status01",
covars = c("age", "trt", "celltype", "karno"),
engine = "coxph_robust"
)
summary(cox_fit)
# Forest Plot for Cox Model
plot_cox_forest(cox_fit)
rale_res <- compute_rale(fit_all)
print(rale_res)
# Calibration of the Cox Model
veteran_clean <- na.omit(veteran)
cal <- calibrate_surv(
fit = cox_fit,
data = veteran_clean,
time_col = "time",
status_col = "status01",
time_point = 180,   # half a year for calibration
ngroups = 10,
observed_method = "km"
)
print(cal)
plot_calibration_surv(cal)
plot_rale_by_strata(fit_trt)
plot_stratified_logrank(data = veteran, time = "time", status = "status01", group = "trt", strata = "celltype")
View(data)
fit_all <- survfit_weighted(
data = lung,
time = "time",
status = "status01"
)
# Plot the survival curve
plot(
fit_all,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability"
)
install.packages("tinytex")
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
data(lung)
# Recode status: 1 = censored, 2 = death
lung$status01 <- as.integer(lung$status == 2)
head(lung)
fit_all <- survfit_weighted(
data = lung,
time = "time",
status = "status01"
)
# Plot the survival curve
plot(
fit_all,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability"
)
strat_res <- stratified_weighted_logrank(
data = lung,
time = "time",
status = "status01",
group = "sex",         # Compare male vs female
strata = "ph.ecog"     # Stratify by performance status
)
strat_res
cox_fit <- fit_cox_cluster(
data = lung,
time = "time",
status = "status01",
covars = c("age", "sex", "ph.ecog"),
engine = "coxph_robust"   # Use robust variance
)
# Show summary of the model
summary(cox_fit)
#Compute RALE
rale_res <- compute_rale(fit_all)
rale_res
# Compute Alpha for Stratified Groups
# The function computes alpha (α) weights for each group level.
# These weights represent the relative importance or scaling
alpha_res <- compute_strata_alpha(
x = lung$sex,          # Grouping variable (e.g., male vs. female)
transform = "linear",  # Transformation type: "log", "sqrt", "linear", etc.
min_alpha = 0.3,
max_alpha = 1,
return_df = TRUE
)
alpha_res
plot_cox_forest(cox_fit)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)  # the data has the missng value
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
cal
# Plot the Calibration Curve
p_cal <- plot_calibration_surv(cal)
print(p_cal)
quarto::render("test2_lung_data.Rmd")
install.packages("tinytex")
tinytex::install_tinytex()
tinytex::is_tinytex()
tinytex::install_tinytex()
Y
y
"Y"
tinytex::install_tinytex()
tinytex::is_tinytex()
