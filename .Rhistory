return_df = TRUE
)
alpha_res
plot_cox_forest(cox_fit)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
cal <- calibrate_surv(
fit = cox_fit,
data = lung,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
help(calibrate_surv)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
cox_fit <- fit_cox_cluster(
data = lung,
time = "time",
status = "status01",
covars = c("age", "sex", "ph.ecog"),
engine = "coxph_robust",
x = TRUE,
y = TRUE
)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
print(cal)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)  # the data has the missng value
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
cal
# Plot the Calibration Curve
p_cal <- plot_calibration_surv(cal)
print(p_cal)
library(survival)
library(saRsurv)
library(dplyr)
data(veteran)
head(veteran)
fit_km <- survfit_weighted(
data = veteran,
time = "time",
status = "status"
)
plot(fit_km,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability")
fit_km_group <- survfit_weighted(
data = veteran,
time = "time",
status = "status",
strata = "trt"
)
plot(fit_km_group,
main = "Kaplan–Meier by Treatment",
col = c("blue", "red"),
lty = 1:2)
legend("topright", legend = levels(factor(veteran$trt)),
col = c("blue", "red"), lty = 1:2)
res_logrank <- weighted_logrank(
data = veteran,
time = "time",
status = "status",
group = "trt"
)
print(res_logrank)
fit_cph <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status",
covariates = c("age", "trt", "celltype")
)
fit_auto <- fit_cox_auto(
data = veteran,
time = "time",
status = "status"
)
log_grid <- logrank_grid(
data = veteran,
time = "time",
status = "status",
group = "trt"
)
print(log_grid)
plot_km_alpha(
data = veteran,
time = "time",
status = "status",
strata = "trt",
alpha = 0.05
)
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
data(veteran)
# Recode status (1=censored, 2=dead → make it 0/1)
veteran$status01 <- as.integer(veteran$status == 1) # or == 2 based on definition
head(veteran)
fit_all <- fit_km(data = veteran, time = "time", status = "status01")
plot(fit_all, main = "Overall Survival (veteran data)", xlab = "Days", ylab = "Survival Probability")
# Automatic KM by group (treatment group: trt)
fit_trt <- fit_km_auto(data = veteran, time = "time", status = "status01", strata = "trt")
plot(fit_trt, main = "Kaplan–Meier by Treatment Group", xlab = "Days", ylab = "Survival Probability")
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr, main = "FH Log-Rank Grid (Veteran)")
cox_fit <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status01",
covars = c("age", "trt", "celltype", "karno"),
engine = "coxph_robust"
)
summary(cox_fit)
# Forest Plot for Cox Model
plot_cox_forest(cox_fit)
rale_res <- compute_rale(fit_all)
print(rale_res)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(fit_trt, data = veteran)
#Compute Alpha for Stratified Group
alpha_res <- compute_strata_alpha(x = veteran$trt, transform = "linear", return_df = TRUE)
print(alpha_res)
plot_km_alpha(
fit_trt,
data = veteran,
group_var = "trt"
)
veteran_clean <- na.omit(veteran)
cal <- calibrate_surv(
fit = cox_fit,
data = veteran_clean,
time_col = "time",
status_col = "status01",
time_point = 180,   # half a year for calibration
ngroups = 10,
observed_method = "km"
)
print(cal)
plot_calibration_surv(cal)
plot_rale_by_strata(fit_trt)
plot_stratified_logrank(data = veteran, time = "time", status = "status01", group = "trt", strata = "celltype")
#Compute Alpha for Stratified Group
# Fit Kaplan–Meier model with explicit formula
fit_trt <- fit_km(
data = veteran,
time = "time",
status = "status01",
strata = "trt"
)
# Compute alpha values
alpha_res <- compute_strata_alpha(
x = veteran$trt,
transform = "linear",
return_df = TRUE
)
print(alpha_res)
# Plot KM with alpha transparency
plot_km_alpha(
fit_trt,
data = veteran,
group_var = "trt"
)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
# Basic weighted log-rank
res_lr <- weighted_logrank(data = veteran, time = "time", status = "status01", group = "trt")
print(res_lr)
# Stratified version (stratify by cell type)
res_lr_strat <- stratified_weighted_logrank(
data = veteran,
time = "time",
status = "status01",
group = "trt",
strata = "celltype"
)
print(res_lr_strat)
# Grid search for FH test
grid_lr <- logrank_grid(data = veteran, time = "time", status = "status01", group = "trt")
print(grid_lr)
plot_logrank_grid(grid_lr)
cox_fit <- fit_cox_cluster(
data = veteran,
time = "time",
status = "status01",
covars = c("age", "trt", "celltype", "karno"),
engine = "coxph_robust"
)
summary(cox_fit)
# Forest Plot for Cox Model
plot_cox_forest(cox_fit)
rale_res <- compute_rale(fit_all)
print(rale_res)
# Calibration of the Cox Model
veteran_clean <- na.omit(veteran)
cal <- calibrate_surv(
fit = cox_fit,
data = veteran_clean,
time_col = "time",
status_col = "status01",
time_point = 180,   # half a year for calibration
ngroups = 10,
observed_method = "km"
)
print(cal)
plot_calibration_surv(cal)
plot_rale_by_strata(fit_trt)
plot_stratified_logrank(data = veteran, time = "time", status = "status01", group = "trt", strata = "celltype")
View(data)
fit_all <- survfit_weighted(
data = lung,
time = "time",
status = "status01"
)
# Plot the survival curve
plot(
fit_all,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability"
)
install.packages("tinytex")
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
# Load necessary libraries
library(survival)
library(saRsurv)
library(dplyr)
library(ggplot2)
data(lung)
# Recode status: 1 = censored, 2 = death
lung$status01 <- as.integer(lung$status == 2)
head(lung)
fit_all <- survfit_weighted(
data = lung,
time = "time",
status = "status01"
)
# Plot the survival curve
plot(
fit_all,
main = "Overall Survival (Kaplan–Meier)",
xlab = "Days",
ylab = "Survival Probability"
)
strat_res <- stratified_weighted_logrank(
data = lung,
time = "time",
status = "status01",
group = "sex",         # Compare male vs female
strata = "ph.ecog"     # Stratify by performance status
)
strat_res
cox_fit <- fit_cox_cluster(
data = lung,
time = "time",
status = "status01",
covars = c("age", "sex", "ph.ecog"),
engine = "coxph_robust"   # Use robust variance
)
# Show summary of the model
summary(cox_fit)
#Compute RALE
rale_res <- compute_rale(fit_all)
rale_res
# Compute Alpha for Stratified Groups
# The function computes alpha (α) weights for each group level.
# These weights represent the relative importance or scaling
alpha_res <- compute_strata_alpha(
x = lung$sex,          # Grouping variable (e.g., male vs. female)
transform = "linear",  # Transformation type: "log", "sqrt", "linear", etc.
min_alpha = 0.3,
max_alpha = 1,
return_df = TRUE
)
alpha_res
plot_cox_forest(cox_fit)
#Calibration of Survival Prediction
# Use 365 days (1 year) as time point for calibration
lung_clean <- na.omit(lung)  # the data has the missng value
cal <- calibrate_surv(
fit = cox_fit,
data = lung_clean,
time_col = "time",
status_col = "status01",
time_point = 365,
ngroups = 10,
observed_method = "km"
)
cal
# Plot the Calibration Curve
p_cal <- plot_calibration_surv(cal)
print(p_cal)
quarto::render("test2_lung_data.Rmd")
install.packages("tinytex")
tinytex::install_tinytex()
tinytex::is_tinytex()
tinytex::install_tinytex()
Y
y
"Y"
tinytex::install_tinytex()
tinytex::is_tinytex()
install_github("saraalmoqbali4-ops/saRsurv")
install.packages("remotes")
library(remotes)
install_github("saraalmoqbali4-ops/saRsurv")
library(saRsurv)
# Plot the two survival KM Curves on the same graph
library(survival)
tt<-c(1.4,1.6,1.8,1.8,2.2,2.4,2.5,2.6,2.8,2.9,3.0,3.1,3.5,3.5,3.6,3.8,3.9,4.1,4.2,4.7,4.9,5.2,5.3,5.4,5.7,5.8,5.9,6.5,6.6,7.8,8.2,8.3,8.4,8.7,8.8,9.1,9.2,9.2,9.8,9.9,10.0,10.2,10.7,11.0,11.1,11.4,11.7,12.1,12.2,12.3)
length(tt)
d<-c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0)
length(d)
Gr<-c(1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0) # group membership.
length(Gr)
Stat<-survdiff(Surv(tt, d)~ Gr)
Stat
plot(survfit(Surv(tt, d)~ Gr), xlab= " Time in weeks", ylab= " Survival Probability",
col=c("blue","red"),lwd=2)
legend("topright", legend=c(" Group I", "Group II"), col=c("blue","red"),lwd=2)
#Plot the confidence intervals for KM curves
Interval.KM<- survfit(Surv(tt,d)~1, conf.type="log-log")
summary(Interval.KM)
plot(Interval.KM, xlab= " Time in weeks", ylab= " Survival Probability", col="blue")
title("KM curve with 95% confidence interval")
#Run a Cox PH Model with the only variable of interest is X=group
result.coxph<- coxph(Surv(tt,d)~Gr) #Fitting Cox Model to data
result.coxph
result.coxph$coef  # extracting the coeficient
summary(result.coxph)
#Compute a 90% confidence interval for the hazard ratio (HR) and interpret the obtained interval
confint(result.coxph, level = 0.90)        # on beta
exp(confint(result.coxph, level = 0.90))   # on HR
library(survival)
tt<-c(1.4,1.6,1.8,1.8,2.2,2.4,2.5,2.6,2.8,2.9,3.0,3.1,3.5,3.5,3.6,3.8,3.9,4.1,4.2,4.7,4.9,5.2,5.3,5.4,5.7,5.8,5.9,6.5,6.6,7.8,8.2,8.3,8.4,8.7,8.8,9.1,9.2,9.2,9.8,9.9,10.0,10.2,10.7,11.0,11.1,11.4,11.7,12.1,12.2,12.3)
length(tt)
d<-c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0)
length(d)
Gr<-c(1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0) # group membership.
length(Gr)
Stat<-survdiff(Surv(tt, d)~ Gr)
Stat
plot(survfit(Surv(tt, d)~ Gr), xlab= " Time in weeks", ylab= " Survival Probability",
col=c("blue","red"),lwd=2)
legend("topright", legend=c(" Group I", "Group II"), col=c("blue","red"),lwd=2)
library(survival)
tt<-c(1.4,1.6,1.8,1.8,2.2,2.4,2.5,2.6,2.8,2.9,3.0,3.1,3.5,3.5,3.6,3.8,3.9,4.1,4.2,4.7,4.9,5.2,5.3,5.4,5.7,5.8,5.9,6.5,6.6,7.8,8.2,8.3,8.4,8.7,8.8,9.1,9.2,9.2,9.8,9.9,10.0,10.2,10.7,11.0,11.1,11.4,11.7,12.1,12.2,12.3)
d<-c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0)
Gr<-c(1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0)
length(Gr)
plot(survfit(Surv(tt, d)~ Gr), xlab= " Time in weeks", ylab= " Survival Probability",
col=c("blue","red"),lwd=2)
legend("topright", legend=c(" Group I", "Group II"), col=c("blue","red"),lwd=2)
Stat <- survdiff(Surv(tt, d) ~ Gr)
Stat
fit <- survfit(Surv(tt, d) ~ Gr)
plot(fit,
conf.int = TRUE,
col = c("blue", "red"),
lwd = 2,
xlab = "Time in weeks",
ylab = "Survival Probability")
legend("topright",
legend = c("Group I", "Group II"),
col = c("blue", "red"),
lwd = 2)
library(survival)
# Kaplan–Meier with confidence intervals (overall)
Interval.KM <- survfit(Surv(tt, d) ~ 1, conf.type = "log-log")
# Plot
plot(
Interval.KM,
xlab = "Time in weeks",
ylab = "Survival Probability",
col = "blue",
lwd = 2,
main = "KM curve with 95% confidence interval"
)
# Kaplan–Meier with confidence intervals (overall)
Interval.KM <- survfit(Surv(tt, d) ~ 1, conf.type = "log-log")
# Plot
plot(
Interval.KM,
xlab = "Time in weeks",
ylab = "Survival Probability",
col = "blue",
lwd = 2,
main = "KM curve with 95% confidence interval"
)
cox_model <- coxph(Surv(tt, d) ~ Gr)
summary(cox_model)
HR_CI_90 <- exp(confint(cox_model, level = 0.90))
HR_CI_90
# Plot the two survival KM Curves on the same graph
library(survival)
tt<-c(1.4,1.6,1.8,1.8,2.2,2.4,2.5,2.6,2.8,2.9,3.0,3.1,3.5,3.5,3.6,3.8,3.9,4.1,4.2,4.7,4.9,5.2,5.3,5.4,5.7,5.8,5.9,6.5,6.6,7.8,8.2,8.3,8.4,8.7,8.8,9.1,9.2,9.2,9.8,9.9,10.0,10.2,10.7,11.0,11.1,11.4,11.7,12.1,12.2,12.3)
length(tt)
d<-c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0)
length(d)
Gr<-c(1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0) # group membership.
length(Gr)
Stat<-survdiff(Surv(tt, d)~ Gr)
Stat
plot(survfit(Surv(tt, d)~ Gr), xlab= " Time in weeks", ylab= " Survival Probability",
col=c("blue","red"),lwd=2)
legend("topright", legend=c(" Group I", "Group II"), col=c("blue","red"),lwd=2)
#Plot the confidence intervals for KM curves
Interval.KM<- survfit(Surv(tt,d)~1, conf.type="log-log")
summary(Interval.KM)
plot(Interval.KM, xlab= " Time in weeks", ylab= " Survival Probability", col="blue")
title("KM curve with 95% confidence interval")
#Run a Cox PH Model with the only variable of interest is X=group
result.coxph<- coxph(Surv(tt,d)~Gr) #Fitting Cox Model to data
result.coxph
result.coxph$coef  # extracting the coeficient
summary(result.coxph)
HR_CI_90 <- exp(confint(cox_model, level = 0.90))
HR_CI_90
library(survival)
tt<-c(1.4,1.6,1.8,1.8,2.2,2.4,2.5,2.6,2.8,2.9,3.0,3.1,3.5,3.5,3.6,3.8,3.9,4.1,4.2,4.7,4.9,5.2,5.3,5.4,5.7,5.8,5.9,6.5,6.6,7.8,8.2,8.3,8.4,8.7,8.8,9.1,9.2,9.2,9.8,9.9,10.0,10.2,10.7,11.0,11.1,11.4,11.7,12.1,12.2,12.3)
d<-c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0)
Gr<-c(1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0)
length(Gr)
plot(survfit(Surv(tt, d)~ Gr), xlab= " Time in weeks", ylab= " Survival Probability",
col=c("blue","red"),lwd=2)
legend("topright", legend=c(" Group I", "Group II"), col=c("blue","red"),lwd=2)
cox_model <- coxph(Surv(tt, d) ~ Gr)
summary(cox_model)
